<!DOCTYPE html>
<html>
    <head>
        <title>Assembl Desktop</title>
        <link rel="stylesheet" href="styles.css" />
        <script>
        const { ipcRenderer } = require('electron');
        const prettySize = require('prettysize');
        const keccak256 = require('js-sha3').keccak256;
        const errors = require('./resources/json/errors.json');
        </script>
        <script src="resources/js/socket.io.js"></script>
        <script src="resources/js/socket.io-stream.js"></script>
        <script src="resources/js/filehandler.js"></script>
        <script src="resources/js/renderer.js"></script>
        <script src="resources/js/screens.js"></script>
        <script src="resources/js/stellarhandler.js"></script>
        <script src="resources/js/webrtchandler.js"></script>
        <script src="resources/js/websockethandler.js"></script>
    </head>
    <body onload="domReady();">
        <div class="screen" id="startup">
            <table style="width: 100%; height: 100%;">
                <tr>
                    <td style="text-align: center;">
                        <img class="assembl-logo-icon" src="resources/png/icon.png" /><div class="assembl-logo-text">Assembl</div>
                        <div style="margin-top: 0px; height: 0px;" class="underthelogo" id="extra-loading">
                            <img class="loading-svg" src="resources/svg/loading.svg" />
                            <div>Starting Assembl Desktop...</div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="screen" id="errorscreen">
            <table style="width: 100%; height: 100%;">
                <tr>
                    <td style="text-align: center;">
                        <img class="assembl-icon" src="resources/svg/error.svg" />
                        <div class="undertheicon" id="purpose-selector">
                            <div style="margin-bottom: 12px;">An error occured</div>
                            <div style="font-size: 0.8em;"><span id="error-details" style="margin-bottom: 4px;">The error failed to load</span>. Error code <span id="error-code">0x0000</span></div>
                            <div id="error-fix" style="margin-bottom: 12px; font-size: 0.8em;">This should never happen. If it does, restart the application.</div>
                            <button type="button" class="connect-button" id="error-btn" onclick="ipcRenderer.send('app-should-close');">Quit Assembl Desktop</button>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="screen" id="passwordinputter">
            <table style="width: 100%; height: 100%;">
                <tr>
                    <td style="text-align: center;">
                        <img class="assembl-logo-icon" src="resources/png/icon.png" /><div class="assembl-logo-text">Assembl</div>
                        <div class="underthelogo" id="purpose-selector">
                            <form id="receiver-input-form" onsubmit="passwordSubmit(event);" autocomplete="off" accept-charset="UTF-8">
                                <div>Enter your password:</div>
                                <input type="password" id="password" placeholder="Enter your password" required minlength="8" maxlength="46" /><br />
                                <div id="password-error"></div>
                                <button type="submit" class="connect-button" id="password-btn">continue</button>
                            </form>
                            <div style="margin-top: 32px; font-size: 0.8em;">Forgot your password, or don't have one yet? <a id="start-fresh-btn" href="javascript:screens.startFreshStarter();">Start fresh</a></div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="screen" id="freshstarter">
            <img class="screen-back" src="resources/svg/arrow_back.svg" onclick="screens.startPasswordInputter();" onkeydown="screens.startPasswordInputter();" title="Go back" alt="Go back" tabindex="0" />
            <table style="width: 100%; height: 100%;">
                <tr>
                    <td style="text-align: center;">
                        <img class="assembl-logo-icon" src="resources/png/icon.png" /><div class="assembl-logo-text">Assembl</div>
                        <div class="underthelogo" id="purpose-selector">
                            <form id="receiver-input-form" onsubmit="freshPasswordSubmit(event);" autocomplete="off" accept-charset="UTF-8">
                                <div>Enter a new password:</div>
                                <input type="password" id="freshpassword" placeholder="Enter a new password" required minlength="8" maxlength="46" /><br />
                                <button type="submit" class="connect-button" id="fresh-btn">start</button>
                            </form>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="screen" id="nameinputter">
            <table style="width: 100%; height: 100%;">
                <tr>
                    <td style="text-align: center;">
                        <img class="assembl-logo-icon" src="resources/png/icon.png" /><div class="assembl-logo-text">Assembl</div>
                        <div class="underthelogo" id="purpose-selector">
                            <form id="receiver-input-form" onsubmit="nameSubmit(event);" autocomplete="off" accept-charset="UTF-8">
                                <div>Enter your name:</div>
                                <input type="text" id="yourname" placeholder="John Smith" required maxlength="46" /><br />
                                <button type="submit" class="connect-button" id="name-set-btn">continue</button>
                            </form>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="screen" id="purpose" style="display: none;">
            <table style="width: 100%; height: 100%;">
                <tr>
                    <td style="text-align: center;">
                        <img class="assembl-logo-icon" src="resources/png/icon.png" /><div class="assembl-logo-text">Assembl</div>
                        <div class="underthelogo" id="purpose-selector">
                            <div style="margin-bottom: 12px;">What would you like to do today?</div>
                            <button class="purpose-button" onclick="screens.startSender();">Send data</button><button class="purpose-button" onclick="screens.startReceiver();">Receive data</button>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="screen" id="sender" style="display: none;">
            <img class="screen-back" src="resources/svg/arrow_back.svg" onclick="screens.startPurposeSelector();" onkeydown="screens.startPurposeSelector();" title="Go back" alt="Go back" tabindex="0" />
            <table style="width: 100%; height: 100%;">
                <tr>
                    <td style="text-align: center;">
                        <img class="assembl-logo-icon" src="resources/png/icon.png" /><div class="assembl-logo-text">Assembl</div>
                        <div class="underthelogo">
                            <div id="protocolselector">
                                <div>Select a transfer method:</div>
                                <select id="protocol" onchange="protocolChange(this.value);">
                                    <option value="unset" disabled selected>Select a transfer method...</option>
                                    <option value="websocket">Proxy</option>
                                    <option value="webrtc">Direct</option>
                                </select>
                                <script>
                                function protocolChange(prot) {
                                    if (prot != "unset" && prot != "") {
                                        fileHandler.protocolToUse = prot;
                                        document.getElementById("protocolselector").style.display = "none";
                                        document.getElementById("peeridfinder").style.display = "block";
                                        document.getElementById("yourpeerid").focus();
                                    }
                                    else {
                                        alert("Select a valid protocol.");
                                    }
                                }
                                // protocolChange(document.getElementById("protocol").value);
                                </script>
                            </div>
                            <div id="peeridfinder" style="display: none;">
                                <div>Give the following ID to the receiving party:</div>
                                <input type="text" id="yourpeerid" readonly onfocus="this.select();" onmousedown="this.select();" />
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="screen" id="dragdrop" style="display: none;">
            <div id="filedropper">
                <input type="file" name="fileChooser" id="fileChooser" onchange="fileHandler.readFile(this.files[0])" required>
                <div id="filedropperborder"></div>
                <div id="itemdropbox">
                    <div id="filedropperdragbg"></div>
                    <div id="itemdrop">Drag &amp; drop<br /><br /><small class="fakebtn">or click here to select a file</small></div>
                </div>
            </div>
        </div>
        <div class="screen" id="loading" style="display: none;">
            <table style="width: 100%; height: 100%;">
                <tr>
                    <td style="text-align: center;">
                        <img class="assembl-logo-icon" src="resources/png/icon.png" /><div class="assembl-logo-text">Assembl</div>
                        <div class="underthelogo">
                            <img class="loading-svg" src="resources/svg/loading.svg" />
                            <!--<progress id="loading-progress" min="0" max="100" value="0"></progress>-->
                            <div id="loading-progress"><div id="loading-progress-inner"></div></div>
                            <div id="loading-status">Loading...</div>
                            <div id="loading-details"></div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="screen" id="receiver" style="display: none;">
            <img class="screen-back" src="resources/svg/arrow_back.svg" onclick="screens.startPurposeSelector();" onkeydown="screens.startPurposeSelector();" title="Go back" alt="Go back" tabindex="0" />
            <table style="width: 100%; height: 100%;">
                <tr>
                    <td style="text-align: center;">
                        <img class="assembl-logo-icon" src="resources/png/icon.png" /><div class="assembl-logo-text">Assembl</div>
                        <div class="underthelogo">
                            <form id="receiver-input-form" onsubmit="formSubmit(event);" autocomplete="off" accept-charset="UTF-8">
                                <div>Enter the sender ID:</div>
                                <input type="text" id="senderpeerid" placeholder="ASXXXXXXXXXX" required pattern="^AS([A-z0-9]{10})$" title="The sender ID (ASXXXXXXXXXX)" maxlength="12" /><br />
                                <button type="submit" class="connect-button" id="connect-btn">connect</button>
                            </form>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div id="copyright">Assembl Desktop v<span id="app-version"></span> &copy; Assembl Inc. 2019</div>
        <script> document.getElementById("app-version").innerHTML = ipcRenderer.sendSync('appversion-request'); </script>
    </body>
</html>
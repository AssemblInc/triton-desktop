<!DOCTYPE html>
<html>
    <head>
        <title>Assembl Desktop Demo</title>
        <link rel="stylesheet" href="styles.css" />
        <script>
        const { ipcRenderer } = require('electron');
        const prettySize = require('prettysize');
        const keccak256 = require('js-sha3').keccak256;
        </script>
        <script src="resources/js/filehandler.js"></script>
        <script src="resources/js/renderer.js"></script>
        <script src="resources/js/screens.js"></script>
        <!-- <script src="resources/js/rtc.js"></script> -->
        <script src="resources/js/stellar.js"></script>
        <script src="resources/js/webrtchandler.js"></script>
        <script src="resources/js/websockethandler.js"></script>
    </head>
    <body onload="domReady();">
        <div class="screen" id="startup">
            <table style="width: 100%; height: 100%;">
                <tr>
                    <td style="text-align: center;">
                        <img class="assembl-logo-icon" src="resources/png/icon.png" /><div class="assembl-logo-text">Assembl</div>
                        <div style="margin-top: 0px; height: 0px;" class="underthelogo" id="extra-loading">
                            <img class="loading-svg" src="resources/svg/loading.svg" />
                            <div>Starting Assembl Desktop...</div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="screen" id="nameinputter">
            <table style="width: 100%; height: 100%;">
                <tr>
                    <td style="text-align: center;">
                        <img class="assembl-logo-icon" src="resources/png/icon.png" /><div class="assembl-logo-text">Assembl</div>
                        <div class="underthelogo" id="purpose-selector">
                            <form id="receiver-input-form" onsubmit="nameSubmit(event);" autocomplete="off" accept-charset="UTF-8">
                                <div>Enter your name:</div>
                                <input type="text" id="yourname" placeholder="John Smith" required maxlength="46" /><br />
                                <button type="submit" class="connect-button" id="name-set-btn">start</button>
                            </form>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="screen" id="purpose" style="display: none;">
            <table style="width: 100%; height: 100%;">
                <tr>
                    <td style="text-align: center;">
                        <img class="assembl-logo-icon" src="resources/png/icon.png" /><div class="assembl-logo-text">Assembl</div>
                        <div class="underthelogo" id="purpose-selector">
                            <div style="margin-bottom: 12px;">What would you like to do today?</div>
                            <button class="purpose-button" onclick="screens.startSender();">Send data</button><button class="purpose-button" onclick="screens.startReceiver();">Receive data</button>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="screen" id="sender" style="display: none;">
            <img class="screen-back" src="resources/svg/arrow_back.svg" onclick="screens.startPurposeSelector();" title="Go back" alt="Go back" />
            <table style="width: 100%; height: 100%;">
                <tr>
                    <td style="text-align: center;">
                        <img class="assembl-logo-icon" src="resources/png/icon.png" /><div class="assembl-logo-text">Assembl</div>
                        <div class="underthelogo">
                            <div id="protocolselector">
                                <div>Select a transfer method:</div>
                                <select id="protocol" onchange="protocolChange(this.value);">
                                    <option value="unset" disabled selected>Select a transfer method...</option>
                                    <option value="websocket">Proxy</option>
                                    <option value="webrtc">Direct</option>
                                </select>
                                <script>
                                function protocolChange(prot) {
                                    if (prot != "unset" && prot != "") {
                                        fileHandler.protocolToUse = prot;
                                        if (prot == "websocket") {
                                            fileHandler.chunkSize = 1048576;     // 1MB in bytes (tested to be the fastest)
                                        }
                                        else {
                                            fileHandler.chunkSize = 16384;      // 16KB in bytes (max chunk size of WebRTC)
                                        }
                                        document.getElementById("protocolselector").style.display = "none";
                                        document.getElementById("peeridfinder").style.display = "block";
                                        document.getElementById("yourpeerid").focus();
                                    }
                                    else {
                                        alert("Select a valid protocol.");
                                    }
                                }
                                // protocolChange(document.getElementById("protocol").value);
                                </script>
                            </div>
                            <div id="peeridfinder" style="display: none;">
                                <div>Give the following ID to the receiving party:</div>
                                <input type="text" id="yourpeerid" readonly onfocus="this.select();" onmousedown="this.select();" />
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div class="screen" id="dragdrop" style="display: none;">
            <div id="filedropper">
                <input type="file" name="fileChooser" id="fileChooser" onchange="fileHandler.readFile(this.files[0])" required>
                <div id="filedropperborder"></div>
                <div id="itemdropbox">
                    <div id="filedropperdragbg"></div>
                    <div id="itemdrop">Drag &amp; drop<br /><br /><small class="fakebtn">or click here to select a file</small></div>
                </div>
            </div>
        </div>
        <div class="screen" id="loading" style="display: none;">
            <table style="width: 100%; height: 100%;">
                    <tr>
                        <td style="text-align: center;">
                            <img class="assembl-logo-icon" src="resources/png/icon.png" /><div class="assembl-logo-text">Assembl</div>
                            <div class="underthelogo">
                                <img class="loading-svg" src="resources/svg/loading.svg" />
                                <!--<progress id="loading-progress" min="0" max="100" value="0"></progress>-->
                                <div id="loading-progress"><div id="loading-progress-inner"></div></div>
                                <div id="loading-status">Loading...</div>
                                <div id="loading-details"></div>
                            </div>
                        </td>
                    </tr>
                </table>
        </div>
        <div class="screen" id="receiver" style="display: none;">
            <img class="screen-back" src="resources/svg/arrow_back.svg" onclick="screens.startPurposeSelector();" title="Go back" alt="Go back" />
            <table style="width: 100%; height: 100%;">
                <tr>
                    <td style="text-align: center;">
                        <img class="assembl-logo-icon" src="resources/png/icon.png" /><div class="assembl-logo-text">Assembl</div>
                        <div class="underthelogo">
                            <form id="receiver-input-form" onsubmit="formSubmit(event);" autocomplete="off" accept-charset="UTF-8">
                                <div>Enter the sender ID:</div>
                                <input type="text" id="senderpeerid" placeholder="QmXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" required pattern="^Qm([a-zA-z0-9]{44})$" title="The sender ID (QmXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX)" maxlength="46" /><br />
                                <button type="submit" class="connect-button" id="connect-btn">connect</button>
                            </form>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <div id="copyright">Assembl Desktop Demo &copy; Assembl Inc. 2019</div>
    </body>
</html>